{% extends "base.html" %}
{% block content %}
<div class="container py-4">
  <h3 class="mb-3">{{ 'Новый рецепт' if mode=='create' else 'Редактирование рецепта' }}</h3>
  <form method="post" class="row g-3">
    <div class="col-md-6">
      <label class="form-label">Склад-переработчик</label>
      <select name="warehouse_id" class="form-select" required>
        <option value="">— выберите склад —</option>
        {% for w in warehouses %}
          <option value="{{ w.id }}" {% if rec.warehouse_id|string == w.id|string %}selected{% endif %}>{{ w.name }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-md-3">
      <label class="form-label">Входной продукт</label>
      <select name="input_product_id" class="form-select" required>
        {% for p in products %}<option value="{{ p.id }}" {% if rec.input_product_id|string == p.id|string %}selected{% endif %}>{{ p.name }}</option>{% endfor %}
      </select>
    </div>
    <div class="col-md-3">
      <label class="form-label">Выходной продукт</label>
      <select name="output_product_id" class="form-select" required>
        {% for p in products %}<option value="{{ p.id }}" {% if rec.output_product_id|string == p.id|string %}selected{% endif %}>{{ p.name }}</option>{% endfor %}
      </select>
    </div>
    <div class="col-md-3">
      <label class="form-label">Норматив выхода, %</label>
      <input name="yield_pct" type="number" step="0.01" class="form-control" value="{{ rec.yield_pct or '' }}" required>
    </div>
    <div class="col-md-3">
      <label class="form-label">Потери, %</label>
      <input name="loss_pct" type="number" step="0.01" class="form-control" value="{{ rec.loss_pct or '0' }}">
    </div>
    <div class="col-md-12">
      <label class="form-label">Примечание</label>
      <textarea name="note" class="form-control" rows="2">{{ rec.note or '' }}</textarea>
    </div>
    <div class="col-md-3 form-check ms-2 mt-2">
      <input type="checkbox" class="form-check-input" id="is_active" name="is_active" {% if rec.is_active in (True,'1','true','on') %}checked{% endif %}>
      <label for="is_active" class="form-check-label">Активный</label>
    </div>
    <div class="col-12 mt-2">
      <button class="btn btn-primary" type="submit">Сохранить</button>
      <a class="btn btn-outline-secondary" href="{{ url_for('recipes.index') }}">Отмена</a>
    </div>
  </form>
</div>
{% endblock %}
